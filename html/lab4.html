<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab 4: Quality Control Hands-on - Bioinformatics 2026</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="../index.html" class="logo">The Bioinformatics Platform - KAUST</a>
            <button class="nav-toggle" onclick="toggleNav()">&#9776;</button>
            <ul id="nav-menu">
                <li><a href="../index.html">Home</a></li>
                <li><a href="schedule.html">Schedule</a></li>
                <li><a href="labs.html" class="active">Labs</a></li>
                <li><a href="projects.html">Projects</a></li>
                <li><a href="setup.html">Setup</a></li>
            </ul>
        </div>
    </nav>

    <main>
        <h1>Lab 4: Quality Control Hands-on</h1>

        <div class="info-box note">
            <strong>Learning Objectives</strong>
            <ul>
                <li>Run FastQC to assess raw read quality</li>
                <li>Interpret FastQC reports and identify quality issues</li>
                <li>Use fastp for quality trimming and adapter removal</li>
            </ul>
        </div>

        <section>
            <h2>Why Quality Control?</h2>
            <div class="card">
                <h3>Common Quality Issues Raw Sequencing Data</h3>
                <ul>
                    <li><strong>Low quality bases:</strong> Especially at read ends (3' end degradation)</li>
                    <li><strong>Adapter contamination:</strong> Sequencing adapters not fully removed</li>
                    <li><strong>Overrepresented sequences:</strong> PCR duplicates or contamination</li>
                    <li><strong>GC bias:</strong> Non-uniform GC content distribution</li>
                    <li><strong>N bases:</strong> Uncalled bases indicating sequencing errors</li>
                </ul>
                <p>Quality control ensures reliable downstream analysis by identifying and addressing these issues.</p>
            </div>
        </section>
        <section>
            <h2>Part 1: Setup on Ibex</h2>
            <p>Connect to Ibex, start an interactive session, and load the tools needed for this lab.</p>

            <div class="step" data-step="1">
                <h3>Connect and start an interactive session</h3>
                <pre><code># Connect to Ibex
ssh username@ilogin.ibex.kaust.edu.sa

# Start an interactive session (never run analyses on login nodes!)
srun --pty --time=3:00:00 --mem=8G --cpus-per-task=4 bash</code></pre>
            </div>

            <div class="step" data-step="2">
                <h3>Load required modules</h3>
                <pre><code># Load bioinformatics tools
module load fastqc
module load fastp
module load seqkit

# Verify tools are loaded
module list</code></pre>
            </div>

            <div class="step" data-step="3">
                <h3>Navigate to your workspace</h3>
                <pre><code># Navigate to your scratch directory
cd /ibex/scratch/$USER

# Create directories for this lab
mkdir workshop
cd workshop
mkdir -p qc/fastqc_raw qc/fastpM<:></:>
mkdir -p trimmed_data 
cd workshop


# Verify
ls -la</code></pre>
            </div>
        </section>
        <section>
            <h2>Part 1: FastQC Analysis</h2>
            <p>FastQC provides a comprehensive quality report for each FASTQ file.</p>

            <div class="step" data-step="1">
                <h3>Run FastQC on raw data</h3>
                <pre><code>
# Run FastQC on all raw FASTQ files
fastqc raw_data/*.fastq.gz -o qc/fastqc_raw -t 4

# List the generated reports
ls -la qc/fastqc_raw/</code></pre>
                <p>FastQC generates two files per sample: an HTML report and a ZIP archive with data.</p>
            </div>

            <div class="step" data-step="2">
                <h3>View FastQC reports</h3>
                <p>Open the HTML report in browser, check under <code>qc/fastqc_raw/</code></p>
                <p>Or view the summary.txt file under the zip folder in  qc/fastqc_raw/</p>
            </div>
        </section>

        <section>
            <h2>Part 2: Interpreting FastQC Reports</h2>

            <div class="card">
                <h3>FastQC Modules Overview</h3>
                <table class="schedule-table">
                    <tr><th>Module</th><th>What it Shows</th><th>Common Issues</th></tr>
                    <tr><td>Per base sequence quality</td><td>Quality scores across read positions</td><td>Low quality at 3' end</td></tr>
                    <tr><td>Per sequence quality scores</td><td>Distribution of mean quality per read</td><td>Bimodal distribution</td></tr>
                    <tr><td>Per base sequence content</td><td>A/T/G/C proportions per position</td><td>Bias at read start</td></tr>
                    <tr><td>Per sequence GC content</td><td>GC% distribution across reads</td><td>Multiple peaks (contamination)</td></tr>
                    <tr><td>Sequence duplication levels</td><td>Read duplication rate</td><td>High duplication</td></tr>
                    <tr><td>Overrepresented sequences</td><td>Frequently occurring sequences</td><td>Adapters</td></tr>
                    <tr><td>Adapter content</td><td>Adapter sequence presence</td><td>Adapter contamination</td></tr>
                </table>
            </div>

            <div class="info-box tip">
                <strong>RNA-seq Specific Considerations</strong>
                <p>Some FastQC warnings are expected for RNA-seq data:</p>
                <ul>
                    <li><strong>Per base sequence content:</strong> Often shows bias at first 10-15 bases due to random hexamer priming - this is normal</li>
                    <li><strong>Sequence duplication:</strong> Higher duplication is expected in RNA-seq due to highly expressed genes</li>
                    <li><strong>GC content:</strong> May show slight deviations from theoretical distribution in RNA-seq</li>
                </ul>
            </div>
        </section>

        <section>
            <h2>Part 3: Quality Trimming with fastp</h2>
            <p>fastp is an all-in-one tool for quality control, trimming, and filtering.</p>

            <div class="step" data-step="4">
                <h3>Run fastp on one sample</h3>
                <pre><code>
# Process one sample first to understand the output
fastp \
    --in1 raw_data/SRR1770413_1.fastq.gz \
    --in2 raw_data/SRR1770413_2.fastq.gz \
    --out1 trimmed_data/SRR1770413_1.trimmed.fastq.gz \
    --out2 trimmed_data/SRR1770413_2.trimmed.fastq.gz \
    --qualified_quality_phred 20 \
    --length_required 36 \
    --detect_adapter_for_pe \
    --overrepresentation_analysis \
    --thread 4 \
    --json qc/fastp/SRR1770413.json \
    --html qc/fastp/SRR1770413.html

# View the HTML report
open qc/fastp/SRR1770413.html</code></pre>

                <div class="info-box note">
                    <strong>fastp Parameters Explained</strong>
                    <ul>
                        <li><code>--qualified_quality_phred 20</code>: Bases below Q20 are considered low quality</li>
                        <li><code>--length_required 36</code>: Discard reads shorter than 36 bp after trimming</li>
                        <li><code>--detect_adapter_for_pe</code>: Auto-detect adapters for paired-end data</li>
                        <li><code>--thread 4</code>: Use 4 CPU threads</li>
                    </ul>
                </div>
            </div>

            <div class="step" data-step="6">
                <h3>Check trimming results</h3>
                <pre><code># Compare file sizes before and after trimming
echo "=== Raw vs Trimmed File Sizes ==="
ls -lh raw_data/*_1.fastq.gz
ls -lh trimmed_data/*_1.trimmed.fastq.gz

# Get read counts before and after
seqkit stats raw_data/*_1.fastq.gz trimmed_data/*_1.trimmed.fastq.gz</code></pre>
            </div>
        </section>

        <section>
            <h2>Part 4: Post-Trimming Quality Check</h2>

            <div class="step" data-step="7">
                <h3>Run FastQC on trimmed data</h3>
                <pre><code>cd ~/genomics

# Run FastQC on trimmed files
fastqc trimmed_data/*.fastq.gz -o qc/fastqc_trimmed -t 4

#Compare a sample before and after
#browse the HTML reports</code></pre>
            </div>

            <div class="step" data-step="8">
                <h3>Generate MultiQC reports</h3>
                <pre><code>cd ~/genomics
    
    # Generate a comprehensive report with all QC data
    multiqc qc_reports/ -o qc_reports -n multiqc_all --force
    
    # Open the combined report in the browser:
    qc_reports/multiqc_all.html</code></pre>
            </div>
    
        </section>
        
        <section>
            <h2>Exercises</h2>
            <div class="card">
                <h3>Exercise 1: Quality Assessment</h3>
                <ol>
                    <li>Which sample has the highest percentage of reads passing filters?</li>
                    <li>Compare the "Per base sequence quality" plots before and after trimming. What improved?</li>
                    <li>Are there any overrepresented sequences? What might they be?</li>
                </ol>
            </div>

            <div class="card">
                <h3>Exercise 2: Parameter Exploration</h3>
                <p>Try running fastp with different parameters on one sample:</p>
                <pre><code># More stringent quality filtering

fastp --in1 raw_data/SRR1770413_1.fastq.gz \
      --in2 raw_data/SRR1770413_2.fastq.gz \
      --out1 test_q30_1.fastq.gz \
      --out2 test_q30_2.fastq.gz \
      --qualified_quality_phred 30 \
      --length_required 50

# Compare read counts
seqkit stats trimmed_data/SRR1770413_1.trimmed.fastq.gz test_q30_1.fastq.gz
rm test_q30_*.fastq.gz</code></pre>
                <p>How does changing the quality threshold affect the number of reads retained?</p>
            </div>
        </section>

        <section>
            <h2>Summary</h2>
            <p>In this lab, you have:</p>
            <ul>
                <li>Run FastQC to assess raw read quality</li>
                <li>Interpreted FastQC reports and understood common metrics</li>
                <li>Used fastp to trim adapters and low-quality bases</li>
                <li>Verified quality improvement after trimming</li>
            </ul>
            
        </section>
    </main>

    <footer>
        <p>Bioinformatics Specialization Program 2026 - KAUST Academy</p>
    </footer>

    <script>
        function toggleNav() {
            document.getElementById('nav-menu').classList.toggle('show');
        }

        // Add copy buttons to all code blocks
        document.addEventListener('DOMContentLoaded', function() {
            const codeBlocks = document.querySelectorAll('pre');
            codeBlocks.forEach(function(pre) {
                const container = document.createElement('div');
                container.className = 'code-container';
                pre.parentNode.insertBefore(container, pre);
                container.appendChild(pre);

                const copyBtn = document.createElement('button');
                copyBtn.className = 'copy-btn';
                copyBtn.textContent = 'Copy';
                copyBtn.addEventListener('click', function() {
                    const code = pre.querySelector('code');
                    const text = code ? code.textContent : pre.textContent;
                    navigator.clipboard.writeText(text).then(function() {
                        copyBtn.textContent = 'Copied!';
                        copyBtn.classList.add('copied');
                        setTimeout(function() {
                            copyBtn.textContent = 'Copy';
                            copyBtn.classList.remove('copied');
                        }, 2000);
                    });
                });
                container.appendChild(copyBtn);
            });
        });
    </script>
</body>
</html>
