<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab 3: Data Retrieval from Public Repositories - Introduction to Applied Bioinformatics 2026</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="../index.html" class="logo">The Bioinformatics Platform - KAUST</a>
            <button class="nav-toggle" onclick="toggleNav()">&#9776;</button>
            <ul id="nav-menu">
                <li><a href="../index.html">Home</a></li>
                <li><a href="schedule.html">Schedule</a></li>
                <li><a href="labs.html" class="active">Labs</a></li>
                <li><a href="setup.html">Setup</a></li>
            </ul>
        </div>
    </nav>

    <main>
        <h1>Lab 3: Data Retrieval from Public Repositories</h1>
        <p>In this lab, you will learn how to find, download, and organize public sequencing data and reference genomes for bioinformatics analysis on the Ibex cluster.</p>

        <div class="info-box note">
            <strong>Learning Objectives</strong>
            <ul>
                <li>Navigate NCBI GEO and SRA to find datasets</li>
                <li>Download sequencing data using sra-tools (<code>prefetch</code>, <code>fasterq-dump</code>)</li>
                <li>Batch-download multiple SRA files using an accession list</li>
                <li>Download reference genomes from NCBI using the <code>datasets</code> CLI tool</li>
                <li>Download reference genomes from Ensembl using <code>wget</code></li>
                <li>Use <code>seqkit</code> to summarize and subsample data</li>
                <li>Organize data with proper directory structure on Ibex</li>
            </ul>
        </div>

        <section>
            <h2>Part 1: Setup on Ibex</h2>
            <p>Connect to Ibex, start an interactive session, and load the tools needed for this lab.</p>

            <div class="step" data-step="1">
                <h3>Connect and start an interactive session</h3>
                <pre><code># Connect to Ibex
ssh username@ilogin.ibex.kaust.edu.sa

# Start an interactive session (never run analyses on login nodes!)
srun --pty --time=3:00:00 --mem=8G --cpus-per-task=4 bash</code></pre>
            </div>

            <div class="step" data-step="2">
                <h3>Load required modules</h3>
                <pre><code># Load bioinformatics tools
module load sratoolkit
module load seqkit

# Verify tools are loaded
module list</code></pre>
            </div>

            <div class="step" data-step="3">
                <h3>Navigate to your workspace</h3>
                <pre><code># Navigate to your scratch directory
cd /ibex/scratch/$USER

# Create directories for this lab
mkdir workshop
cd workshop

# Create directories for this lab
mkdir -p raw_data references

# Verify
ls -la</code></pre>
            </div>
        </section>

        <section>
            <h2>Part 2: Finding Data on NCBI</h2>
            <p>Before downloading data, you need to know how to find it. NCBI hosts two key resources:</p>
                <ol>
                <li>GEO (Gene Expression Omnibus) for expression data: <a href="https://www.ncbi.nlm.nih.gov/geo">https://www.ncbi.nlm.nih.gov/geo</a></li>    
                <li>SRA (Sequence Read Archive) for raw sequencing data: <a href="https://www.ncbi.nlm.nih.gov/sra">https://www.ncbi.nlm.nih.gov/sra</a></li>
                </ol>
                

            <div class="step" data-step="ncbi-1">
                <h3>Step 1: Navigate to NCBI GEO</h3>
                <p>NCBI GEO is a public repository for gene expression and genomics datasets.</p>
                <ol>
                    <li>Open your web browser and go to <a href="https://www.ncbi.nlm.nih.gov/geo/" target="_blank">https://www.ncbi.nlm.nih.gov/geo/</a></li>
                    <li>You will see the GEO homepage with a search box at the top</li>
                </ol>
            </div>

            <div class="step" data-step="ncbi-2">
                <h3>Step 2: Search for a Dataset</h3>
                <p>As an example, search for accession <code>GSE136366</code> (a TDP-43 RNA-seq study):</p>
                <ol>
                    <li>In the search box, type: <code>GSE136366</code></li>
                    <li>Click "Search" or press Enter</li>
                    <li>Click on the accession number <strong>GSE136366</strong> to view the full record</li>
                </ol>
            </div>

            <div class="step" data-step="ncbi-3">
                <h3>Step 3: Explore the GEO Series Page</h3>
                <p>The GEO Series page contains important information about the dataset:</p>
                <ul>
                    <li><strong>Title:</strong> Full study title and description</li>
                    <li><strong>Summary:</strong> Experimental design and objectives</li>
                    <li><strong>Overall design:</strong> Sample information and conditions</li>
                    <li><strong>Samples:</strong> List of all individual samples (GSM accessions)</li>
                    <li><strong>Citation:</strong> Link to the published paper</li>
                </ul>
            </div>

            <div class="step" data-step="ncbi-4">
                <h3>Step 4: Navigate to SRA from GEO</h3>
                <p>To access the raw FASTQ files, you need to go to the SRA:</p>
                <ol>
                    <li>Scroll down to the <strong>"Relations"</strong> section on the GEO page</li>
                    <li>Look for the link labeled <strong>"SRA"</strong> and click on it</li>
                    <li>Alternatively, click on any individual sample (GSM accession) to find its SRA run</li>
                </ol>
            </div>

            <div class="step" data-step="ncbi-5">
                <h3>Step 5: SRA Run Selector</h3>
                <p>The SRA Run Selector provides metadata about each sequencing run:</p>
                <ol>
                    <li>Click "Send results to Run selector" if not already there</li>
                    <li>The table shows important metadata columns:
                        <table class="schedule-table">
                            <tr><th>Column</th><th>Description</th></tr>
                            <tr><td><strong>Run</strong></td><td>SRR accession number (used for download)</td></tr>
                            <tr><td><strong>Sample</strong></td><td>Sample name from the study</td></tr>
                            <tr><td><strong>LibraryLayout</strong></td><td>SINGLE or PAIRED (single-end vs paired-end)</td></tr>
                            <tr><td><strong>Bases</strong></td><td>Total sequencing bases</td></tr>
                            <tr><td><strong>Spots</strong></td><td>Number of reads (or read pairs)</td></tr>
                            <tr><td><strong>Platform</strong></td><td>Sequencing platform (e.g., ILLUMINA)</td></tr>
                        </table>
                    </li>
                </ol>
            </div>

            <div class="info-box tip">
                <strong>Tip: Always Check the Metadata!</strong>
                <p>Before downloading any dataset, review the sequencing platform, library layout (single-end vs paired-end), read length, and total read count. This information determines which analysis pipeline to use.</p>
            </div>

            <div class="step" data-step="ncbi-6">
                <h3>Workshop Dataset</h3>
                <p>For this workshop, we will use a small <em>E. coli</em> dataset to keep download times and processing fast:</p>
                <table class="schedule-table">
                    <tr><th>Property</th><th>Value</th></tr>
                    <tr><td>SRA Accession</td><td><code>SRR1770413</code></td></tr>
                    <tr><td>Organism</td><td><em>Escherichia coli</em></td></tr>
                    <tr><td>Library Layout</td><td>Paired-end</td></tr>
                    <tr><td>Platform</td><td>Illumina</td></tr>
                </table>
            </div>
        </section>

        <section>
            <h2>Part 3: Downloading Data with sra-tools</h2>
            <p>The SRA Toolkit provides command-line tools to download and convert SRA data. The two main commands are <code>prefetch</code> (downloads compressed .sra files) and <code>fasterq-dump</code> (converts .sra to FASTQ).</p>

            <div class="step" data-step="1">
                <h3>Navigate to your raw data directory</h3>
                <pre><code>cd /ibex/scratch/$USER/workshop/raw_data</code></pre>
            </div>

            <div class="step" data-step="3">
                <h3>Download using prefetch &amp; convert to fastq using fasterq-dump</h3>
                <pre><code># Download the .sra file (faster and more reliable than direct FASTQ download)
prefetch SRR1770413

#Convert .sra file to fastq format
fasterq-dump --split-files SRR1770413/SRR1770413.sra</code></pre>
            </div>

        </section>

        <section>
            <h2>Part 4: Downloading Reference Genomes</h2>
            <p>Reference genomes and gene annotations are available from two major sources: <strong>NCBI</strong> and <strong>Ensembl</strong>. Both provide the same biological data but differ in naming conventions, annotation sources, and access tools. We will cover both approaches.</p>

            <div class="step" data-step="ref-0">
                <h3>Navigate to your references directory</h3>
                <pre><code>cd /ibex/scratch/$USER/workshop/references</code></pre>
            </div>

            <!-- ===== Option A: NCBI datasets ===== -->
            <h3 style="margin-top:2rem; padding:0.5rem 1rem; background:#e8f4fd; border-left:4px solid #2196F3;">Option A: Download from NCBI using <code>datasets</code></h3>
            <p>NCBI provides the <code>datasets</code> command-line tool &ndash; a modern, fast way to download genomes, annotations, and gene data directly from the NCBI database.</p>

            <div class="step" data-step="ncbi-ds-1">
                <h3>Get the NCBI datasets tool</h3>
                <pre><code># 
wget https://ftp.ncbi.nlm.nih.gov/pub/datasets/command-line/v2/linux-amd64/datasets
#Make the tool (datasets) executable
chmod +x datasets

# Verify installation
datasets --help</code></pre>
            </div>

            <div class="step" data-step="ncbi-ds-2">
                <h3>Search for a genome assembly</h3>
                <p>You can search for genomes by organism name or assembly accession:</p>
                <pre><code># Search for E. coli genomes and list available assemblies
datasets summary genome taxon "Escherichia coli" | head -5

# Search by specific assembly accession
datasets summary genome accession GCF_000005845.2</code></pre>
                <div class="info-box note">
                    <strong>Understanding Assembly Accessions</strong>
                    <ul>
                        <li><code>GCF_</code> prefix &ndash; NCBI RefSeq assembly (curated, recommended)</li>
                        <li><code>GCA_</code> prefix &ndash; GenBank assembly (submitted by researchers)</li>
                    </ul>
                    <p>For most analyses, prefer <strong>RefSeq (GCF_)</strong> assemblies as they are more standardized.</p>
                </div>
            </div>

            <div class="step" data-step="ncbi-ds-3">
                <h3>Download genome and annotation</h3>
                <p>The <code>datasets download</code> command fetches the genome FASTA, annotation (GTF/GFF3), and metadata in a single zip archive:</p>
                <pre><code># Download E. coli K-12 reference genome with annotations
datasets download genome accession GCF_000005845.2 \
    --include genome,gtf,gff3,seq-report

# This creates a file called ncbi_dataset.zip
ls -lh ncbi_dataset.zip</code></pre>
                <div class="info-box note">
                    <strong><code>--include</code> Options</strong>
                    <table class="schedule-table">
                        <tr><th>Option</th><th>Downloads</th></tr>
                        <tr><td><code>genome</code></td><td>Genome FASTA sequence</td></tr>
                        <tr><td><code>gtf</code></td><td>Gene annotation in GTF format</td></tr>
                        <tr><td><code>gff3</code></td><td>Gene annotation in GFF3 format</td></tr>
                        <tr><td><code>rna</code></td><td>Transcript sequences (RNA FASTA)</td></tr>
                        <tr><td><code>protein</code></td><td>Protein sequences (amino acid FASTA)</td></tr>
                        <tr><td><code>cds</code></td><td>Coding sequences (CDS FASTA)</td></tr>
                        <tr><td><code>seq-report</code></td><td>Sequence report with chromosome info</td></tr>
                    </table>
                </div>
            </div>

            <div class="step" data-step="ncbi-ds-4">
                <h3>Extract and organize the downloaded files</h3>
                <pre><code># Extract the zip archive
unzip ncbi_dataset.zip

# See the directory structure
ls ncbi_dataset/data/GCF_000005845.2/

# The extracted files will include:
#   GCF_000005845.2_ASM584v2_genomic.fna   - genome FASTA
#   genomic.gtf                             - gene annotation (GTF)
#   genomic.gff                             - gene annotation (GFF3)

# Copy files to your references directory with clear names
cp ncbi_dataset/data/GCF_000005845.2/*.fna ecoli_genome.fa
cp ncbi_dataset/data/GCF_000005845.2/genomic.gtf ecoli_genes.gtf

# Verify the genome
seqkit stats ecoli_genome.fa

# Clean up the zip and extracted directory
rm -r ncbi_dataset ncbi_dataset.zip</code></pre>
            </div>

            <div class="step" data-step="ncbi-ds-5">
                <h3>Download multiple genomes or by taxon</h3>
                <pre><code># Download multiple assemblies at once
datasets download genome accession GCF_000005845.2 GCF_000819615.1 \
    --include genome,gtf

# Download the latest reference genome for a species by name
datasets download genome taxon "Homo sapiens" \
    --reference --include genome,gtf

# Download all available E. coli assemblies (careful: can be large!)
# datasets download genome taxon "Escherichia coli" --include genome</code></pre>
            </div>

            <div class="step" data-step="ncbi-ds-6">
                <h3>Explore genome metadata with <code>dataformat</code></h3>
                <p>The companion tool <code>dataformat</code> helps you extract structured information from NCBI datasets:</p>
                <pre><code># Get a TSV summary of genome metadata
datasets summary genome accession GCF_000005845.2 | \
    dataformat tsv genome --fields organism-name,assminfo-name,assminfo-level,assmstats-total-sequence-len

# Fields you can query:
# organism-name, assminfo-name, assminfo-level,
# assmstats-total-sequence-len, assmstats-contig-n50,
# annotinfo-gene-count, annotinfo-protein-count</code></pre>
            </div>

            <!-- ===== Option B: Ensembl FTP ===== -->
            <h3 style="margin-top:2rem; padding:0.5rem 1rem; background:#e8f8e8; border-left:4px solid #4CAF50;">Option B: Download from Ensembl using <code>wget</code></h3>
            <p>Ensembl provides reference genomes and gene annotations for thousands of species. Files are organized on their FTP server by release version, species, and data type.</p>

            <div class="step" data-step="ensembl-1">
                <h3>Understanding the Ensembl FTP Structure</h3>
                <p>The Ensembl FTP site is organized as follows:</p>
                <pre><code>ftp.ensemblgenomes.org/pub/bacteria/
├── release-57/
│   ├── fasta/                    # Sequence files (genome, cDNA, protein)
│   │   └── bacteria_0_collection/
│   │       └── escherichia_coli_.../
│   │           └── dna/          # Genomic DNA sequences
│   ├── gff3/                     # Gene annotations (GFF3 format)
│   │   └── bacteria_0_collection/
│   └── gtf/                      # Gene annotations (GTF format)
└── current/                      # Symlink to latest release</code></pre>
                <div class="info-box note">
                    <strong>Ensembl vs Ensembl Genomes</strong>
                    <ul>
                        <li><strong>ftp.ensembl.org</strong> &ndash; Vertebrate species (human, mouse, zebrafish, etc.)</li>
                        <li><strong>ftp.ensemblgenomes.org</strong> &ndash; Non-vertebrate species (bacteria, plants, fungi, etc.)</li>
                    </ul>
                    <p>Use the appropriate server for your organism.</p>
                </div>
            </div>

            <div class="step" data-step="ensembl-2">
                <h3>Download E. coli K-12 reference genome</h3>
                <pre><code># Download E. coli K-12 MG1655 reference genome
wget https://ftp.ensemblgenomes.org/pub/bacteria/release-57/fasta/bacteria_0_collection/escherichia_coli_str_k_12_substr_mg1655_gca_000005845/dna/Escherichia_coli_str_k_12_substr_mg1655_gca_000005845.ASM584v2.dna.toplevel.fa.gz</code></pre>
            </div>

            <div class="step" data-step="ensembl-3">
                <h3>Download gene annotation</h3>
                <pre><code># Download GFF3 annotation file
wget https://ftp.ensemblgenomes.org/pub/bacteria/release-57/gff3/bacteria_0_collection/escherichia_coli_str_k_12_substr_mg1655_gca_000005845/Escherichia_coli_str_k_12_substr_mg1655_gca_000005845.ASM584v2.57.gff3.gz</code></pre>
            </div>

            <div class="step" data-step="ensembl-4">
                <h3>Decompress and verify</h3>
                <pre><code># Decompress all downloaded files
gunzip *.gz

# Check reference genome statistics
seqkit stats *.fa

# List files
ls -lh</code></pre>
            </div>

            <!-- ===== Comparison ===== -->
            <div class="info-box note">
                <strong>NCBI vs Ensembl: Which to Use?</strong>
                <table class="schedule-table">
                    <tr><th>Feature</th><th>NCBI (datasets)</th><th>Ensembl (wget)</th></tr>
                    <tr><td>Download tool</td><td><code>datasets</code> tool</td><td><code>wget</code> / <code>curl</code></td></tr>
                    <tr><td>Naming</td><td>RefSeq accessions (GCF_/GCA_)</td><td>Ensembl-specific names</td></tr>
                    <tr><td>Annotations</td><td>NCBI RefSeq gene models</td><td>Ensembl/GENCODE gene models</td></tr>
                    <tr><td>Chromosome names</td><td>NC_ accessions or chromosome numbers</td><td>Chromosome numbers (1, 2, X, MT)</td></tr>
                    <tr><td>Best for</td><td>Prokaryotes, clinical/NCBI pipelines</td><td>Eukaryotes, RNA-seq, GENCODE consistency</td></tr>
                </table>
                <p>Both are valid choices. The key is to be consistent &ndash;<br/> Always use the genome and annotation from the <em>same source</em> to avoid mismatches in chromosome names.</p>
            </div>
        </section>

        <section>
            <h2>Part 5: Subsampling Data</h2>
            <p>Large datasets can take a long time to process. Subsampling creates a smaller representative subset that is useful for testing pipelines and for workshop exercises.</p>

            <div class="step" data-step="1">
                <h3>Subsample to 100,000 reads</h3>
                <pre><code>cd /ibex/scratch/$USER/workshop

# Subsample to 100,000 reads for faster processing
# -n 100000: number of reads to keep
# -s 42: random seed for reproducibility
seqkit sample -n 100000 -s 42 raw_data/SRR1770413_1.fastq -o raw_data/SRR1770413_subsample_1.fastq
seqkit sample -n 100000 -s 42 raw_data/SRR1770413_2.fastq -o raw_data/SRR1770413_subsample_2.fastq</code></pre>
            </div>

            <div class="step" data-step="2">
                <h3>Verify subsampled files</h3>
                <pre><code># Check statistics of subsampled files
seqkit stats raw_data/ecoli_*.fastq.gz</code></pre>
            </div>

            <div class="info-box note">
                <strong>Why Subsample?</strong>
                <p>Subsampling is useful when you want to quickly test a pipeline, debug parameters, or run a workshop exercise without waiting hours for full datasets to process. Always use the <code>-s</code> (seed) flag so results are reproducible.</p>
            </div>
        </section>

        <section>
            <h2>Part 6: Exploring Downloaded Data</h2>
            <p>Before proceeding with analysis, always inspect your downloaded data to make sure everything looks correct.</p>

            <div class="step" data-step="1">
                <h3>Inspect raw reads</h3>
                <pre><code>cd /ibex/scratch/$USER/workshop

# Quick look at the first few reads (3 reads = 12 lines in FASTQ)
gzip -dc raw_data/ecoli_R1.fastq.gz | head -12</code></pre>
                <div class="info-box note">
                    <strong>FASTQ Format Reminder</strong>
                    <p>Each read consists of 4 lines:</p>
                    <ol>
                        <li><code>@</code> followed by the read identifier</li>
                        <li>The DNA sequence</li>
                        <li><code>+</code> (separator line)</li>
                        <li>Quality scores (ASCII-encoded Phred scores)</li>
                    </ol>
                </div>
            </div>

            <div class="step" data-step="2">
                <h3>Reference genome statistics</h3>
                <pre><code># Get stats for the reference genome
seqkit stats references/*.fa</code></pre>
            </div>

            <div class="step" data-step="3">
                <h3>Preview the annotation file</h3>
                <pre><code># View the first 30 lines of the GFF3 annotation
head -30 references/*.gff3</code></pre>
            </div>
        </section>

        <section>
            <h2>Exercises</h2>

            <div class="card">
                <h3>Exercise 1: Read Counts</h3>
                <p>How many reads are in the original SRR1770413 dataset? Use <code>seqkit stats</code> on the full (non-subsampled) files to find out.</p>
                <details>
                    <summary>Hint</summary>
                    <pre><code>seqkit stats raw_data/SRR1770413_*.fastq.gz</code></pre>
                </details>
            </div>

            <div class="card">
                <h3>Exercise 2: Genome Size</h3>
                <p>What is the genome size of <em>E. coli</em> K-12? Use <code>seqkit stats</code> on the reference FASTA to determine this.</p>
                <details>
                    <summary>Hint</summary>
                    <pre><code>seqkit stats references/*.fa</code></pre>
                </details>
            </div>

            <div class="card">
                <h3>Exercise 3: Gene Count</h3>
                <p>How many genes are annotated in the GFF3 file? Use <code>grep</code> to count lines containing "gene" features.</p>
                <details>
                    <summary>Hint</summary>
                    <pre><code># Count lines where the feature type (column 3) is "gene"
grep -c "gene" references/*.gff3</code></pre>
                </details>
            </div>

            <div class="card">
                <h3>Exercise 4: Download Another Dataset</h3>
                <p>Choose an additional SRA dataset of your choice (any small dataset). Download it using <code>prefetch</code> and <code>fasterq-dump</code>, then run <code>seqkit stats</code> to get its summary statistics.</p>
                <details>
                    <summary>Hint</summary>
                    <pre><code># Example with a different accession
prefetch SRR_ACCESSION
fasterq-dump --split-files SRR_ACCESSION
gzip SRR_ACCESSION*.fastq
seqkit stats SRR_ACCESSION*.fastq.gz</code></pre>
                </details>
            </div>
        </section>

        <section>
            <h2>Summary</h2>
            <p>In this lab, you have:</p>
            <ul>
                <li>Learned how to navigate NCBI GEO and SRA to find public sequencing datasets</li>
                <li>Downloaded raw sequencing data from SRA using <code>prefetch</code> and <code>fasterq-dump</code></li>
                <li>Learned to batch-download multiple SRA files using an accession list file</li>
                <li>Downloaded a reference genome using <strong>NCBI <code>datasets</code></strong> CLI (Option A)</li>
                <li>Downloaded a reference genome from <strong>Ensembl FTP</strong> using <code>wget</code> (Option B)</li>
                <li>Explored genome metadata using <code>dataformat</code></li>
                <li>Used <code>seqkit</code> to summarize and subsample FASTQ data</li>
                <li>Organized all data with a proper directory structure on Ibex</li>
            </ul>
            <p><strong>Next:</strong> <a href="lab4.html">Lab 4 - Quality Control: FastQC &amp; Trimming</a></p>
        </section>
    </main>

    <footer>
        <p>Introduction to Applied Bioinformatics 2026 - KAUST</p>
    </footer>

    <script>
        function toggleNav() {
            document.getElementById('nav-menu').classList.toggle('show');
        }

        // Add copy buttons to all code blocks
        document.addEventListener('DOMContentLoaded', function() {
            const codeBlocks = document.querySelectorAll('pre');
            codeBlocks.forEach(function(pre) {
                const container = document.createElement('div');
                container.className = 'code-container';
                pre.parentNode.insertBefore(container, pre);
                container.appendChild(pre);

                const copyBtn = document.createElement('button');
                copyBtn.className = 'copy-btn';
                copyBtn.textContent = 'Copy';
                copyBtn.addEventListener('click', function() {
                    const code = pre.querySelector('code');
                    const text = code ? code.textContent : pre.textContent;
                    navigator.clipboard.writeText(text).then(function() {
                        copyBtn.textContent = 'Copied!';
                        copyBtn.classList.add('copied');
                        setTimeout(function() {
                            copyBtn.textContent = 'Copy';
                            copyBtn.classList.remove('copied');
                        }, 2000);
                    });
                });
                container.appendChild(copyBtn);
            });
        });
    </script>
</body>
</html>
